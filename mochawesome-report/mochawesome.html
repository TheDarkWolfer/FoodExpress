<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:3,&quot;tests&quot;:33,&quot;passes&quot;:33,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2025-10-23T23:39:42.466Z&quot;,&quot;end&quot;:&quot;2025-10-23T23:39:47.131Z&quot;,&quot;duration&quot;:4665,&quot;testsRegistered&quot;:33,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;0e570e0f-43a8-4d9e-89a1-a64f2adf9d12&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;title&quot;:&quot;MENU router&quot;,&quot;fullFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/test/menus-test.js&quot;,&quot;file&quot;:&quot;/test/menus-test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;MENU router\&quot;&quot;,&quot;fullTitle&quot;:&quot;MENU router \&quot;before all\&quot; hook in \&quot;MENU router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:647,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const _res = await supertest(app)\n.post(\&quot;/menu\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;Fillet o&#x27; Jetfish\&quot;,\n  description:\&quot;A cooked filet of jetfish, straight from Shoreline !\&quot;,\n  price:13.99,\n  category:\&quot;seafood\&quot;\n})\n.expect(201) // Devrait pas poser problème, mais on sais jamais\nID4l8r = _res.body._id // on prépare une variable pour stocker l&#x27;ID qu&#x27;on va secouer un peu pour les tests\nmenusIDs.push(ID4l8r) // On prévois de nettoyer après les tests, quand même&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b85eaf35-c462-4303-8882-06e6dab384c6&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;MENU router\&quot;&quot;,&quot;fullTitle&quot;:&quot;MENU router \&quot;after all\&quot; hook in \&quot;MENU router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; menusIDs.length; i++) {\nconst gettingDeleted = menusIDs[i];\nawait supertest(app).delete(`/menu/${gettingDeleted}`).set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\nconsole.log(`Menu with ID &lt;${gettingDeleted}&gt; got deleted !`)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b4a9c567-6545-4434-9060-79c9d9292f17&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;GET /menu -&gt; 200 avec les données en JSON&quot;,&quot;fullTitle&quot;:&quot;MENU router GET /menu -&gt; 200 avec les données en JSON&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:114,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const gettingAllMenus = await supertest(app)\n.get(\&quot;/menu\&quot;)\n.expect(200)\n.expect(\&quot;Content-Type\&quot;,/json/) // On vérifie qu&#x27;on a bien un objet JSON&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cfd65a44-6ff2-4e07-b41b-cf723a901875&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;GET /menu avec query -&gt; 200 avec des données JSON filtrées&quot;,&quot;fullTitle&quot;:&quot;MENU router GET /menu avec query -&gt; 200 avec des données JSON filtrées&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const gettingMenus = await supertest(app)\n.get(\&quot;/menu\&quot;)\n.query({search:\&quot;Bat\&quot;})\n.expect(200)\n.expect(\&quot;Content-Type\&quot;,/json/)\nassert.ok(Array.isArray(gettingMenus.body),\&quot;Response should be an array. (if it&#x27;s not, send help)\&quot;)\n// &#x27;Dé-commenter&#x27; la ligne qui suit pour checker le nombre d&#x27;objets rendus par le filtre. Désactivé par défaut car \n// vérifier la longueur de la réponse dépend du filtre utilisé dans les tests, du contenu de la base de données, et \n// probablement de la phase de la lune à ce point...\n//assert.equal(gettingMenus.body.length,10,\&quot;Should display 10 items. If not, bring some help please.\&quot;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c285cd9e-e22e-44eb-9eed-fa42911a40bf&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /menu sans token -&gt; 401 Unauthorized&quot;,&quot;fullTitle&quot;:&quot;MENU router POST /menu sans token -&gt; 401 Unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const unauthorizedAttempt = await supertest(app)\n.post(\&quot;/menu\&quot;)\n.send({\n  name:\&quot;Unfortunate Development\&quot;,\n  description:\&quot;The results of poor planning\&quot;,\n  price:99.99,\n  category:\&quot;mistakes\&quot;\n})\n.expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;34893415-a72f-4e3e-a650-536de13464f8&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /menu avec token utilisateur.ice -&gt; 403 Forbidden&quot;,&quot;fullTitle&quot;:&quot;MENU router POST /menu avec token utilisateur.ice -&gt; 403 Forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const forbiddenAttempt = await supertest(app)\n.post(\&quot;/menu\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.send({\n  name:\&quot;Coalescepide Curry\&quot;,\n  description:\&quot;A bunch of coalescepides fried in a nice curry\&quot;,\n  price:12.34,\n  category:\&quot;spicy\&quot;\n})\n.expect(403)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37e589f6-3c61-41ad-9a5f-c9be4817578d&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /menu avec token administrateur.ice -&gt; 201 Created&quot;,&quot;fullTitle&quot;:&quot;MENU router POST /menu avec token administrateur.ice -&gt; 201 Created&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const newMenuCreation = await supertest(app)\n.post(\&quot;/menu\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;Neuron Fly\&quot;,\n  description:\&quot;A singular neuron fly ; may cause glowing upon consumption\&quot;,\n  price:101.99,\n  category:\&quot;enlightened\&quot;\n})\n.expect(201)\n.expect(\&quot;Content-Type\&quot;,/json/)\n// On vérifie le contenu de la réponse à laquelle nous avons droit\nexpect(newMenuCreation.body).to.be.an(\&quot;object\&quot;);\nexpect(newMenuCreation.body.name).to.equal(\&quot;Neuron Fly\&quot;);\nexpect(newMenuCreation.body).to.have.property(\&quot;_id\&quot;);\nmenusIDs.push(newMenuCreation.body._id);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;afe87052-47c3-4198-9f7a-090975c0a001&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /menu/&lt;ID&gt; sans token -&gt; 401 Unauthorized&quot;,&quot;fullTitle&quot;:&quot;MENU router PATCH /menu/&lt;ID&gt; sans token -&gt; 401 Unauthorized&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const unauthenticatedPatch = await supertest(app)\n.patch(`/menu/${ID4l8r}`)\n.send({\n  name:\&quot;Red Spider Roast\&quot;,\n  description:\&quot;Just mind the toxins...\&quot;\n})\n.expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;68f6f901-fb1f-4ec1-be21-44e4df5b74e2&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /menu/&lt;ID&gt; avec un token utilisateur.ice -&gt; 403 Forbidden&quot;,&quot;fullTitle&quot;:&quot;MENU router PATCH /menu/&lt;ID&gt; avec un token utilisateur.ice -&gt; 403 Forbidden&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const forbiddenPatch = await supertest(app)\n.patch(`/menu/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.send({\n  name:\&quot;Chilly Popcorn plant\&quot;,\n  description:\&quot;Popcorn plant bred in the harsh winters of the Silent Construct, a tasty dessert\&quot;\n})\n.expect(403)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;93873d8d-487b-43db-9d3b-a7dd6f1ae259&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /menu/&lt;ID&gt; avec un token administrateur.ice -&gt; 200&quot;,&quot;fullTitle&quot;:&quot;MENU router PATCH /menu/&lt;ID&gt; avec un token administrateur.ice -&gt; 200&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:61,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const successfulPatch = await supertest(app)\n.patch(`/menu/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;[REDACTED]\&quot;,\n  description:\&quot;Recipe to engineer one&#x27;s cells to allow for self-annihilation. Unavailable under the self-annihilation edict\&quot;\n})\n.expect(200)\n\nexpect(successfulPatch.body).to.be.an(\&quot;object\&quot;);\nexpect(successfulPatch.body.name).to.equal(\&quot;[REDACTED]\&quot;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0b7ae0a7-d902-426a-9335-3289013c96bd&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /menu/&lt;ID&gt; -&gt; 401&quot;,&quot;fullTitle&quot;:&quot;MENU router DELETE /menu/&lt;ID&gt; -&gt; 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const unauthorizedDelete = await supertest(app)\n.delete(`/menu/${ID4l8r}`)\n.expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ea708d3b-19e3-47db-bb9b-33ec7a277e5d&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /menu/&lt;ID&gt; avec token utilisateur.ice -&gt; 403&quot;,&quot;fullTitle&quot;:&quot;MENU router DELETE /menu/&lt;ID&gt; avec token utilisateur.ice -&gt; 403&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const forbiddenDelete = await supertest(app)\n.delete(`/menu/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.expect(403)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;efc4d9f5-3f75-49be-be65-4e127ff4376c&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /menu/&lt;ID&gt; avec token administrateur.ice -&gt; 200&quot;,&quot;fullTitle&quot;:&quot;MENU router DELETE /menu/&lt;ID&gt; avec token administrateur.ice -&gt; 200&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:57,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const successfulDelete = await supertest(app)\n.delete(`/menu/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.expect(200)\nmenusIDs = menusIDs.filter(id =&gt; id !== ID4l8r)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aeb8bdf4-83e9-43eb-bd57-24b2a5b4dc36&quot;,&quot;parentUUID&quot;:&quot;b078428b-7c5f-40be-995b-71c8b616d840&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;cfd65a44-6ff2-4e07-b41b-cf723a901875&quot;,&quot;c285cd9e-e22e-44eb-9eed-fa42911a40bf&quot;,&quot;34893415-a72f-4e3e-a650-536de13464f8&quot;,&quot;37e589f6-3c61-41ad-9a5f-c9be4817578d&quot;,&quot;afe87052-47c3-4198-9f7a-090975c0a001&quot;,&quot;68f6f901-fb1f-4ec1-be21-44e4df5b74e2&quot;,&quot;93873d8d-487b-43db-9d3b-a7dd6f1ae259&quot;,&quot;0b7ae0a7-d902-426a-9335-3289013c96bd&quot;,&quot;ea708d3b-19e3-47db-bb9b-33ec7a277e5d&quot;,&quot;efc4d9f5-3f75-49be-be65-4e127ff4376c&quot;,&quot;aeb8bdf4-83e9-43eb-bd57-24b2a5b4dc36&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:360,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;title&quot;:&quot;RESTAURANT router&quot;,&quot;fullFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/test/restaurants-test.js&quot;,&quot;file&quot;:&quot;/test/restaurants-test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router \&quot;before all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const _res = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;Outer Expanse\&quot;,\n  address:\&quot;Past the Farm Arrays\&quot;,\n  phone:\&quot;77777777\&quot;,\n  opening_hours:\&quot;Every Cycle\&quot;\n})\n.expect(201) // Devrait pas poser problème, mais on sais jamais\nID4l8r = _res.body._id // on prépare une variable pour stocker l&#x27;ID qu&#x27;on va secouer un peu pour les tests\nrestaurantsIDs.push(ID4l8r) // On prévois de nettoyer après les tests, quand même&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;03fb5b87-0ade-444d-b6cb-9b16dbb3601a&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router \&quot;after all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; restaurantsIDs.length; i++) {\nconst gettingDeleted = restaurantsIDs[i];\nawait supertest(app).delete(`/restaurants/${gettingDeleted}`).set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\nconsole.log(`Restaurant with ID &lt;${gettingDeleted}&gt; got deleted !`)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2afd8dbe-149a-44ee-a3b7-3318e2244786&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;GET /restaurants sans token -&gt; Réussite et affichage des restaurants&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router GET /restaurants sans token -&gt; Réussite et affichage des restaurants&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const simpleGET = await supertest(app)\n.get(\&quot;/restaurants\&quot;)\n.expect(200)\n.then((res) =&gt; {\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5e9a4dea-b224-4d1c-927e-c3468784ff83&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants sans token -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants sans token -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const designedToFail = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.send({\n  name:\&quot;The Restaurant of Failure\&quot;,\n  address:\&quot;401 Error Avenue, FailCity\&quot;,\n  phone:\&quot;401000000\&quot;,\n  opening_hours:\&quot;From 4:01am to 4:01pm\&quot;\n})\n.expect(401)\n.then((res)=&gt; {expect(res.body).to.have.property(&#x27;error&#x27;) // On s&#x27;assure d&#x27;avoir un message en plus du code d&#x27;erreur\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;44895ac1-e5a7-4143-a20a-5aca6c9abeeb&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants avec token utilisateur -&gt; Erreur 403, mais cette fois c&#x27;est un problème de rôle&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants avec token utilisateur -&gt; Erreur 403, mais cette fois c&#x27;est un problème de rôle&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const designedToFailButDifferently = await supertest(app) \n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.send({\n  name:\&quot;The Restaurant of Failure 2 Electric boogaloo\&quot;,\n  address:\&quot;403 Error Avenue, FailCity\&quot;,\n  phone:\&quot;403000000\&quot;,\n  opening_hours:\&quot;From 4:03am to 4:03pm\&quot;\n})\n.expect(403)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;08572e0c-a4b4-44c5-af3b-123a44136070&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants avec token admin -&gt; Création d&#x27;un nouveau restaurant&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants avec token admin -&gt; Création d&#x27;un nouveau restaurant&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const designedToSucceed = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;The Restaurant of Success\&quot;,\n  address:\&quot;200 Success Street, GoodCity\&quot;,\n  phone:\&quot;200200200\&quot;,\n  opening_hours:\&quot;From 2:00am to 2:00am\&quot;\n})\n.expect(201)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;685ba41d-0ae8-4dc8-a1e6-d8eced9cd937&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants avec un token valide mais des données invalides -&gt; Erreur 400&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants avec un token valide mais des données invalides -&gt; Erreur 400&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const willFailAgain = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:new Set(),\n  address:NaN,\n  phone:undefined\n  // Pas d&#x27;horaires, histoire de vraiment tout faire comme il faut pas :p\n})\n.expect(400)\n.then((res) =&gt; {\n  // On s&#x27;assure de bien avoir une erreur de validation\n  expect(res.body).to.have.property(&#x27;message&#x27;).that.equals(\&quot;Validation error\&quot;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;13a85902-5a98-4c66-882f-5bd7463fba34&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router PATCH /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const patch2Fail = await supertest(app)\n.patch(`/restaurants/${ID4l8r}`)\n.send({\n  name:\&quot;Subterranean\&quot;\n})\n.expect(401)\n.then((res)=&gt;{\n  expect(res.body).to.have.property(&#x27;error&#x27;).that.equals(&#x27;Missing or invalid Authorization header&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ead26e85-259e-43cb-be11-aa7313aef3b1&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /restaurants avec un token utilisateur.ice -&gt; Erreur 403&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router PATCH /restaurants avec un token utilisateur.ice -&gt; Erreur 403&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const otherPatch2Fail = await supertest(app)\n.patch(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.send({\n  name:\&quot;Metropolis\&quot;\n})\n.expect(403)\n.then((res) =&gt; {\n  expect(res.body).to.have.property(&#x27;error&#x27;).that.equals(\&quot;Access forbidden to this ID, sorry\&quot;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;120c83cf-d45a-4937-b5e6-0775101d97c0&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /restaurants avec des données invalides&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router PATCH /restaurants avec des données invalides&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const patchWithBadData = await supertest(app)\n.patch(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;Metropolis\&quot;,\n  owner:\&quot;Five Pebbles\&quot;\n})\n.expect(400)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73493599-f289-4085-b101-61ac9021306d&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router DELETE /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const deleteThatWillFail = await supertest(app)\n.delete(`/restaurants/${ID4l8r}`)\n.expect(401)\n.then((res)=&gt;{\n  // On vérifie qu&#x27;on a la bonne erreur\n  expect(res.body).to.have.property(&#x27;error&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc76c236-10ea-4401-980f-feddec0bd5cd&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /restaurants avec token utilisateur.ice -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router DELETE /restaurants avec token utilisateur.ice -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const anotherDeleteThatWillFail = await supertest(app)\n.delete(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.expect(403)\n.then((res) =&gt; {\n  // Encore une fois, on checke que c&#x27;est la bonne erreur\n  expect(res.body).to.have.property(&#x27;error&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90d0d7a4-8212-40dd-859d-a2c832920eea&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /restaurants avec token admin -&gt; 200&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router DELETE /restaurants avec token admin -&gt; 200&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:54,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const aDeleteThatWorks = await supertest(app)\n.delete(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.expect(200)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7126109c-7d79-4d5d-a65c-b249658f0000&quot;,&quot;parentUUID&quot;:&quot;010f866a-fc93-4d93-afdb-c5407493352f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5e9a4dea-b224-4d1c-927e-c3468784ff83&quot;,&quot;44895ac1-e5a7-4143-a20a-5aca6c9abeeb&quot;,&quot;08572e0c-a4b4-44c5-af3b-123a44136070&quot;,&quot;685ba41d-0ae8-4dc8-a1e6-d8eced9cd937&quot;,&quot;13a85902-5a98-4c66-882f-5bd7463fba34&quot;,&quot;ead26e85-259e-43cb-be11-aa7313aef3b1&quot;,&quot;120c83cf-d45a-4937-b5e6-0775101d97c0&quot;,&quot;73493599-f289-4085-b101-61ac9021306d&quot;,&quot;bc76c236-10ea-4401-980f-feddec0bd5cd&quot;,&quot;90d0d7a4-8212-40dd-859d-a2c832920eea&quot;,&quot;7126109c-7d79-4d5d-a65c-b249658f0000&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:184,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;title&quot;:&quot;USER router&quot;,&quot;fullFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/test/users-test.js&quot;,&quot;file&quot;:&quot;/test/users-test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;USER router\&quot;&quot;,&quot;fullTitle&quot;:&quot;USER router \&quot;after all\&quot; hook in \&quot;USER router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:321,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; usersIDs.length; i++) {\nconst gettingDeleted = usersIDs[i];\nawait supertest(app).delete(`/users/${gettingDeleted}`).set(\&quot;Authorization\&quot;,`Bearer ${rawAdminToken}`)\nconsole.log(`User with ID &lt;${gettingDeleted}&gt; got deleted !`)\n  }&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55576422-84c2-415c-b4e1-05f6cc13cd27&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;GET /users&quot;,&quot;fullTitle&quot;:&quot;USER router GET /users&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await supertest(app)\n.get(\&quot;/users\&quot;)\n.expect(403)\n.then((response)=&gt;{\n  assert.equal(typeof(response.body),&#x27;object&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c41873ce-3550-4bac-bf85-94f84967785b&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users -&gt; création d&#x27;un utilisateur lambda&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users -&gt; création d&#x27;un utilisateur lambda&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:248,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userBody = await supertest(app)\n.post(\&quot;/users\&quot;)\n.send({\n  email:\&quot;lambda@xyz.org\&quot;,\n  username:\&quot;lambda\&quot;,\n  password:\&quot;test1234\&quot;,\n  role:\&quot;user\&quot;\n}).expect(201).expect(\&quot;Content-type\&quot;,/json/)\nusersIDs.push(userBody.body.id)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d0676e2-a5bb-4c7f-8c62-271f6d438b68&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users -&gt; création d&#x27;un.e utilisateur.ice déjà présent.e dans la base de données&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users -&gt; création d&#x27;un.e utilisateur.ice déjà présent.e dans la base de données&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:290,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const duplicateBody = await supertest(app)\n.post(\&quot;/users\&quot;)\n.send({\n  email:\&quot;lambda@xyz.org\&quot;,\n  username:\&quot;lambda\&quot;,\n  password:\&quot;qwerty\&quot;,\n  role:\&quot;user\&quot;\n}).expect(409)\n// usersIDs.push(duplicateBody.body.id) // J&#x27;ai laissé ça là au cas où, mais normalement la création de cet.te utilisateur.ice échoue\n                                      // alors c&#x27;est pas nécessaire&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;644d5b4b-0684-41dc-a18e-e43eb524c4ef&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users -&gt; création d&#x27;utilisateur admin&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users -&gt; création d&#x27;utilisateur admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:277,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userAdmin = await supertest(app)\n.post(\&quot;/users\&quot;)\n.send({\n  email:\&quot;maestro@xyz.org\&quot;,\n  username:\&quot;maestro\&quot;,\n  password:\&quot;test1234\&quot;,\n  role:\&quot;admin\&quot;\n}).expect(201).expect(\&quot;Content-type\&quot;,/json/) // Utilisation d&#x27;un (tout petit) regex pour la validation du type de réponse\nusersIDs.push(userAdmin.body.id)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c08b1faa-051e-4459-af4e-ce92adf16253&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users/login -&gt; JWT login en tant qu&#x27;utilisateur.ice&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users/login -&gt; JWT login en tant qu&#x27;utilisateur.ice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:440,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await supertest(app)\n.post(\&quot;/users/login\&quot;)\n.send({\n  username:\&quot;lambda\&quot;,\n  password:\&quot;test1234\&quot;\n}).expect(200)\nconst { token } = res.body;\nexpect(token).to.be.a(&#x27;string&#x27;);\n/*-----------------------+\n| Vérification du token |\n+-----------------------*/\nconst decoded = jwt.decode(token, { complete: true });\nexpect(decoded).to.be.an(&#x27;object&#x27;);\nexpect(decoded).to.have.property(&#x27;header&#x27;);\nexpect(decoded.header).to.include({ alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; });\nexpect(decoded.payload).to.include.keys([&#x27;sub&#x27;, &#x27;iat&#x27;, &#x27;exp&#x27;, &#x27;role&#x27;]);\n\n  // Et vérification de la signature du token\n  const verified = jwt.verify(token, process.env.SECRET, {\nalgorithms: [&#x27;HS256&#x27;]\n  });\n\n  expect(verified.sub).to.be.a(&#x27;string&#x27;);\n  expect(verified.role).to.equal(&#x27;user&#x27;);\n  expect(verified.exp * 1000).to.be.greaterThan(Date.now()); // On s&#x27;assure que le token est toujours valide\n\n  userToken = verified // Stockage du token utilisateur.ice pour plus tard\n  rawUserToken = token&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;607a1389-ec1d-49ca-b29e-750eda2f01f1&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users/login -&gt; JWT login en tant qu&#x27;administrateur.ice&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users/login -&gt; JWT login en tant qu&#x27;administrateur.ice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:419,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await supertest(app)\n.post(\&quot;/users/login\&quot;)\n.send({\n  username:\&quot;maestro\&quot;,\n  password:\&quot;test1234\&quot;\n}).expect(200)\nconst { token } = res.body;\nexpect(token).to.be.a(&#x27;string&#x27;);\n/*-----------------------+\n| Vérification du token |\n+-----------------------*/\nconst decoded = jwt.decode(token, { complete: true });\nexpect(decoded).to.be.an(&#x27;object&#x27;);\nexpect(decoded).to.have.property(&#x27;header&#x27;);\nexpect(decoded.header).to.include({ alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; }); // adapt if RS256\nexpect(decoded.payload).to.include.keys([&#x27;sub&#x27;, &#x27;iat&#x27;, &#x27;exp&#x27;, &#x27;role&#x27;]); // adapt to your claims\n\n\n  // Et vérification de la signature du token\n  const verified = jwt.verify(token, process.env.SECRET, {\nalgorithms: [&#x27;HS256&#x27;]\n  });\n\n  expect(verified.sub).to.be.a(&#x27;string&#x27;);\n  expect(verified.role).to.equal(&#x27;admin&#x27;);\n  expect(verified.exp * 1000).to.be.greaterThan(Date.now()); // On s&#x27;assure que le token est toujours valide\n\n  adminToken = verified // Stockage du token administrateur.ice pour plus tard\n  rawAdminToken = token&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64a6b11d-4a55-4698-820d-cad54ac686ed&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /users/login/&lt;userID&gt; -&gt; Lambda peut y accéder, Maestro aussi&quot;,&quot;fullTitle&quot;:&quot;USER router PATCH /users/login/&lt;userID&gt; -&gt; Lambda peut y accéder, Maestro aussi&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:252,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userID = userToken.sub\nconst res = await supertest(app)\n.patch(`/users/${userID}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${rawUserToken}`)\n.send({\n  username:\&quot;omicron\&quot;,\n  password:\&quot;azerty\&quot;\n}).expect(200)\n// On s&#x27;assure vite fait que la réponse contient bien les modifications demandées\nexpect(res.body.username).to.equal(\&quot;omicron\&quot;);\nexpect(res.body).to.not.have.property(\&quot;password\&quot;); // La réponse ne doit pas renvoyer le mdp, même hashé. On vérifie au cas où&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0777fd38-b08d-48fa-b734-111de758ec74&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /users/login/&lt;adminID&gt; -&gt; Maestro peut y accéder, Lambda/Omicron ne peut pas&quot;,&quot;fullTitle&quot;:&quot;USER router PATCH /users/login/&lt;adminID&gt; -&gt; Maestro peut y accéder, Lambda/Omicron ne peut pas&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:55,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userID = userToken.sub\nconst res = await supertest(app)\n.patch(`/users/${userID}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${rawAdminToken}`)\n.send({\n  username:\&quot;lambda\&quot;,\n  email:\&quot;some.email@xyz.gay\&quot;\n}).expect(200)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6271415e-b18c-4eb1-b6f8-f73399b54691&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /users/login/&lt;adminID&gt; -&gt; Maestro pourrait y accéder, Lambda ne peut pas et prend une erreur&quot;,&quot;fullTitle&quot;:&quot;USER router PATCH /users/login/&lt;adminID&gt; -&gt; Maestro pourrait y accéder, Lambda ne peut pas et prend une erreur&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:990,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userID = userToken.sub\n  \n// Création et login d&#x27;un utilisateur juste pour ce test\nconst gammaRes = await supertest(app)\n.post(\&quot;/users/\&quot;)\n.send({\n  email:\&quot;gamma@xyz.org\&quot;,\n  username:\&quot;gamma\&quot;,\n  password:\&quot;test1234\&quot;,\n  role:\&quot;user\&quot;\n}).expect(201).expect(\&quot;Content-type\&quot;,/json/)\nusersIDs.push(gammaRes.body.id)\nconst _res = await supertest(app)\n.post(\&quot;/users/login\&quot;)\n.send({\n  username:\&quot;gamma\&quot;,\n  password:\&quot;test1234\&quot;\n}).expect(200)\nconst { token } = _res.body;\nconst res = await supertest(app)\n.patch(`/users/${userID}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${token}`)\n.send({\n  email:\&quot;evil.email@mean.corp\&quot;,\n  username:\&quot;pwnd\&quot;,\n  password:\&quot;evil-password\&quot;,\n  role:\&quot;evil-admin\&quot;\n}).expect(403).expect(\&quot;Content-type\&quot;,/json/)\nexpect(res.body).to.have.property(&#x27;error&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1bad52d8-9f56-475f-9f34-de9244a07fa2&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Tente un PATCH sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;fullTitle&quot;:&quot;USER router Tente un PATCH sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const randomID = usersIDs[Math.floor(Math.random() * usersIDs.length)]; // On choisis une ID aléatoire, le test doit échouer de toute manière\nawait supertest(app)\n.patch(`/users/${randomID}`)\n.send({\n  email:\&quot;this.should@fail.now\&quot;\n}).expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2acbe3b5-23ef-42a2-9ec8-136fd0cd987d&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Tente un DELETE sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;fullTitle&quot;:&quot;USER router Tente un DELETE sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const randomID = usersIDs[Math.floor(Math.random() * usersIDs.length)]; // ID aléatoire, encore une fois\nawait supertest(app)\n.delete(`/users/${randomID}`)\n.expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f6d6a80b-bc11-46c9-a3a9-46327728326e&quot;,&quot;parentUUID&quot;:&quot;2bebd79f-5f87-48d9-b8ea-445a60d63200&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c41873ce-3550-4bac-bf85-94f84967785b&quot;,&quot;9d0676e2-a5bb-4c7f-8c62-271f6d438b68&quot;,&quot;644d5b4b-0684-41dc-a18e-e43eb524c4ef&quot;,&quot;c08b1faa-051e-4459-af4e-ce92adf16253&quot;,&quot;607a1389-ec1d-49ca-b29e-750eda2f01f1&quot;,&quot;64a6b11d-4a55-4698-820d-cad54ac686ed&quot;,&quot;0777fd38-b08d-48fa-b734-111de758ec74&quot;,&quot;6271415e-b18c-4eb1-b6f8-f73399b54691&quot;,&quot;1bad52d8-9f56-475f-9f34-de9244a07fa2&quot;,&quot;2acbe3b5-23ef-42a2-9ec8-136fd0cd987d&quot;,&quot;f6d6a80b-bc11-46c9-a3a9-46327728326e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:2975,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.4&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.4&quot;},&quot;marge&quot;:{&quot;version&quot;:&quot;6.3.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;FoodExpress&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>