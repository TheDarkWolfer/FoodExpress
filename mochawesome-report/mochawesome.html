<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:2,&quot;tests&quot;:22,&quot;passes&quot;:22,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;start&quot;:&quot;2025-10-23T11:16:16.555Z&quot;,&quot;end&quot;:&quot;2025-10-23T11:16:22.262Z&quot;,&quot;duration&quot;:5707,&quot;testsRegistered&quot;:22,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;02f5aae7-d75c-4650-8e63-dbb7cc30efbe&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;title&quot;:&quot;RESTAURANT router&quot;,&quot;fullFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/test/restaurants-test.js&quot;,&quot;file&quot;:&quot;/test/restaurants-test.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router \&quot;before all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:804,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const _res = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;Outer Expanse\&quot;,\n  address:\&quot;Past the Farm Arrays\&quot;,\n  phone:\&quot;77777777\&quot;,\n  opening_hours:\&quot;Every Cycle\&quot;\n})\n.expect(201) // Devrait pas poser problème, mais on sais jamais\nID4l8r = _res.body._id // on prépare une variable pour stocker l&#x27;ID qu&#x27;on va secouer un peu pour les tests\nrestaurantsIDs.push(ID4l8r) // On prévois de nettoyer après les tests, quand même&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4dab1794-c3c0-462f-a92a-c9d5b78ec12f&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router \&quot;after all\&quot; hook in \&quot;RESTAURANT router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:58,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; restaurantsIDs.length; i++) {\nconst gettingDeleted = restaurantsIDs[i];\nawait supertest(app).delete(`/restaurants/${gettingDeleted}`).set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\nconsole.log(`Restaurant with ID &lt;${gettingDeleted}&gt; got deleted !`)\n}&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d2589de-2e94-42b4-9b57-eeeb09240e53&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;GET /restaurants sans token -&gt; Réussite et affichage des restaurants&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router GET /restaurants sans token -&gt; Réussite et affichage des restaurants&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:107,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const simpleGET = await supertest(app)\n.get(\&quot;/restaurants\&quot;)\n.expect(200)\n.then((res) =&gt; {\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90aec982-3211-490d-8460-06260edce63d&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants sans token -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants sans token -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const designedToFail = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.send({\n  name:\&quot;The Restaurant of Failure\&quot;,\n  address:\&quot;401 Error Avenue, FailCity\&quot;,\n  phone:\&quot;401000000\&quot;,\n  opening_hours:\&quot;From 4:01am to 4:01pm\&quot;\n})\n.expect(401)\n.then((res)=&gt; {expect(res.body).to.have.property(&#x27;error&#x27;) // On s&#x27;assure d&#x27;avoir un message en plus du code d&#x27;erreur\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc950e08-5536-4451-9263-9b343a05ea8a&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants avec token utilisateur -&gt; Erreur 403, mais cette fois c&#x27;est un problème de rôle&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants avec token utilisateur -&gt; Erreur 403, mais cette fois c&#x27;est un problème de rôle&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const designedToFailButDifferently = await supertest(app) \n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.send({\n  name:\&quot;The Restaurant of Failure 2 Electric boogaloo\&quot;,\n  address:\&quot;403 Error Avenue, FailCity\&quot;,\n  phone:\&quot;403000000\&quot;,\n  opening_hours:\&quot;From 4:03am to 4:03pm\&quot;\n})\n.expect(403)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;05ab2dd8-4ffe-42cd-9e82-ede04f56385f&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants avec token admin -&gt; Création d&#x27;un nouveau restaurant&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants avec token admin -&gt; Création d&#x27;un nouveau restaurant&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:62,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const designedToSucceed = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;The Restaurant of Success\&quot;,\n  address:\&quot;200 Success Street, GoodCity\&quot;,\n  phone:\&quot;200200200\&quot;,\n  opening_hours:\&quot;From 2:00am to 2:00am\&quot;\n})\n.expect(201)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0bca40bf-7118-4112-b782-952fdd0869b5&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /restaurants avec un token valide mais des données invalides -&gt; Erreur 400&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router POST /restaurants avec un token valide mais des données invalides -&gt; Erreur 400&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const willFailAgain = await supertest(app)\n.post(\&quot;/restaurants\&quot;)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:new Set(),\n  address:NaN,\n  phone:undefined\n  // Pas d&#x27;horaires, histoire de vraiment tout faire comme il faut pas :p\n})\n.expect(400)\n.then((res) =&gt; {\n  // On s&#x27;assure de bien avoir une erreur de validation\n  expect(res.body).to.have.property(&#x27;message&#x27;).that.equals(\&quot;Validation error\&quot;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd9a5b4b-4894-474c-8d69-e424df80442d&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router PATCH /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const patch2Fail = await supertest(app)\n.patch(`/restaurants/${ID4l8r}`)\n.send({\n  name:\&quot;Subterranean\&quot;\n})\n.expect(401)\n.then((res)=&gt;{\n  expect(res.body).to.have.property(&#x27;error&#x27;).that.equals(&#x27;Missing or invalid Authorization header&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65d76412-2a1e-4319-853d-62d819c9499d&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /restaurants avec un token utilisateur.ice -&gt; Erreur 403&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router PATCH /restaurants avec un token utilisateur.ice -&gt; Erreur 403&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const otherPatch2Fail = await supertest(app)\n.patch(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.send({\n  name:\&quot;Metropolis\&quot;\n})\n.expect(403)\n.then((res) =&gt; {\n  expect(res.body).to.have.property(&#x27;error&#x27;).that.equals(\&quot;Access forbidden to this ID, sorry\&quot;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4cf7142b-6117-4c52-9a34-d91f94b9ea36&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /restaurants avec des données invalides&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router PATCH /restaurants avec des données invalides&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const patchWithBadData = await supertest(app)\n.patch(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.send({\n  name:\&quot;Metropolis\&quot;,\n  owner:\&quot;Five Pebbles\&quot;\n})\n.expect(400)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;78b9f965-352d-41d0-88fa-b9df44362288&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router DELETE /restaurants sans token valide -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const deleteThatWillFail = await supertest(app)\n.delete(`/restaurants/${ID4l8r}`)\n.expect(401)\n.then((res)=&gt;{\n  // On vérifie qu&#x27;on a la bonne erreur\n  expect(res.body).to.have.property(&#x27;error&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f87ec7e9-b4a3-4ac9-af1c-c3369201432a&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /restaurants avec token utilisateur.ice -&gt; Erreur 401&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router DELETE /restaurants avec token utilisateur.ice -&gt; Erreur 401&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const anotherDeleteThatWillFail = await supertest(app)\n.delete(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${userToken}`)\n.expect(403)\n.then((res) =&gt; {\n  // Encore une fois, on checke que c&#x27;est la bonne erreur\n  expect(res.body).to.have.property(&#x27;error&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bcf0ed7b-ea75-4eca-a52d-b8ca8b536dbc&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;DELETE /restaurants avec token admin -&gt; 200&quot;,&quot;fullTitle&quot;:&quot;RESTAURANT router DELETE /restaurants avec token admin -&gt; 200&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:60,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const aDeleteThatWorks = await supertest(app)\n.delete(`/restaurants/${ID4l8r}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${adminToken}`)\n.expect(200)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;14ddeef6-046d-42f1-8dba-39cd0935c892&quot;,&quot;parentUUID&quot;:&quot;aa132f98-fb17-43b0-91c0-5cdfe2ec3b09&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;90aec982-3211-490d-8460-06260edce63d&quot;,&quot;cc950e08-5536-4451-9263-9b343a05ea8a&quot;,&quot;05ab2dd8-4ffe-42cd-9e82-ede04f56385f&quot;,&quot;0bca40bf-7118-4112-b782-952fdd0869b5&quot;,&quot;bd9a5b4b-4894-474c-8d69-e424df80442d&quot;,&quot;65d76412-2a1e-4319-853d-62d819c9499d&quot;,&quot;4cf7142b-6117-4c52-9a34-d91f94b9ea36&quot;,&quot;78b9f965-352d-41d0-88fa-b9df44362288&quot;,&quot;f87ec7e9-b4a3-4ac9-af1c-c3369201432a&quot;,&quot;bcf0ed7b-ea75-4eca-a52d-b8ca8b536dbc&quot;,&quot;14ddeef6-046d-42f1-8dba-39cd0935c892&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:274,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;title&quot;:&quot;USER router&quot;,&quot;fullFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/test/users-test.js&quot;,&quot;file&quot;:&quot;/test/users-test.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;USER router\&quot;&quot;,&quot;fullTitle&quot;:&quot;USER router \&quot;after all\&quot; hook in \&quot;USER router\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:203,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;for (let i = 0; i &lt; usersIDs.length; i++) {\nconst gettingDeleted = usersIDs[i];\nawait supertest(app).delete(`/users/${gettingDeleted}`).set(\&quot;Authorization\&quot;,`Bearer ${rawAdminToken}`)\nconsole.log(`User with ID &lt;${gettingDeleted}&gt; got deleted !`)\n  }&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6662f163-c824-44c3-94b5-837e02076484&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;GET /users&quot;,&quot;fullTitle&quot;:&quot;USER router GET /users&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;await supertest(app)\n.get(\&quot;/users\&quot;)\n.expect(403)\n.then((response)=&gt;{\n  assert.equal(typeof(response.body),&#x27;object&#x27;)\n})&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2847748f-94b2-4326-9ea6-871733a0f9ac&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users -&gt; création d&#x27;un utilisateur lambda&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users -&gt; création d&#x27;un utilisateur lambda&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:412,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userBody = await supertest(app)\n.post(\&quot;/users\&quot;)\n.send({\n  email:\&quot;lambda@xyz.org\&quot;,\n  username:\&quot;lambda\&quot;,\n  password:\&quot;test1234\&quot;,\n  role:\&quot;user\&quot;\n}).expect(201).expect(\&quot;Content-type\&quot;,/json/)\nusersIDs.push(userBody.body.id)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c6b09dde-1967-42ab-ae97-637e7a4978be&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users -&gt; création d&#x27;un.e utilisateur.ice déjà présent.e dans la base de données&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users -&gt; création d&#x27;un.e utilisateur.ice déjà présent.e dans la base de données&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:407,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const duplicateBody = await supertest(app)\n.post(\&quot;/users\&quot;)\n.send({\n  email:\&quot;lambda@xyz.org\&quot;,\n  username:\&quot;lambda\&quot;,\n  password:\&quot;qwerty\&quot;,\n  role:\&quot;user\&quot;\n}).expect(409)\n// usersIDs.push(duplicateBody.body.id) // J&#x27;ai laissé ça là au cas où, mais normalement la création de cet.te utilisateur.ice échoue\n                                      // alors c&#x27;est pas nécessaire&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9bca2f0c-ad19-4c84-97a5-f549b94f0a74&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users -&gt; création d&#x27;utilisateur admin&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users -&gt; création d&#x27;utilisateur admin&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:413,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userAdmin = await supertest(app)\n.post(\&quot;/users\&quot;)\n.send({\n  email:\&quot;maestro@xyz.org\&quot;,\n  username:\&quot;maestro\&quot;,\n  password:\&quot;test1234\&quot;,\n  role:\&quot;admin\&quot;\n}).expect(201).expect(\&quot;Content-type\&quot;,/json/) // Utilisation d&#x27;un (tout petit) regex pour la validation du type de réponse\nusersIDs.push(userAdmin.body.id)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;860303ea-462f-48c8-adf7-b0d92778b20c&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users/login -&gt; JWT login en tant qu&#x27;utilisateur.ice&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users/login -&gt; JWT login en tant qu&#x27;utilisateur.ice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:738,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await supertest(app)\n.post(\&quot;/users/login\&quot;)\n.send({\n  username:\&quot;lambda\&quot;,\n  password:\&quot;test1234\&quot;\n}).expect(200)\nconst { token } = res.body;\nexpect(token).to.be.a(&#x27;string&#x27;);\n/*-----------------------+\n| Vérification du token |\n+-----------------------*/\nconst decoded = jwt.decode(token, { complete: true });\nexpect(decoded).to.be.an(&#x27;object&#x27;);\nexpect(decoded).to.have.property(&#x27;header&#x27;);\nexpect(decoded.header).to.include({ alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; });\nexpect(decoded.payload).to.include.keys([&#x27;sub&#x27;, &#x27;iat&#x27;, &#x27;exp&#x27;, &#x27;role&#x27;]);\n\n  // Et vérification de la signature du token\n  const verified = jwt.verify(token, process.env.SECRET, {\nalgorithms: [&#x27;HS256&#x27;]\n  });\n\n  expect(verified.sub).to.be.a(&#x27;string&#x27;);\n  expect(verified.role).to.equal(&#x27;user&#x27;);\n  expect(verified.exp * 1000).to.be.greaterThan(Date.now()); // On s&#x27;assure que le token est toujours valide\n\n  userToken = verified // Stockage du token utilisateur.ice pour plus tard\n  rawUserToken = token&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;26c8c040-fe0c-40d4-a7f7-d6119cd2a600&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;POST /users/login -&gt; JWT login en tant qu&#x27;administrateur.ice&quot;,&quot;fullTitle&quot;:&quot;USER router POST /users/login -&gt; JWT login en tant qu&#x27;administrateur.ice&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:741,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const res = await supertest(app)\n.post(\&quot;/users/login\&quot;)\n.send({\n  username:\&quot;maestro\&quot;,\n  password:\&quot;test1234\&quot;\n}).expect(200)\nconst { token } = res.body;\nexpect(token).to.be.a(&#x27;string&#x27;);\n/*-----------------------+\n| Vérification du token |\n+-----------------------*/\nconst decoded = jwt.decode(token, { complete: true });\nexpect(decoded).to.be.an(&#x27;object&#x27;);\nexpect(decoded).to.have.property(&#x27;header&#x27;);\nexpect(decoded.header).to.include({ alg: &#x27;HS256&#x27;, typ: &#x27;JWT&#x27; }); // adapt if RS256\nexpect(decoded.payload).to.include.keys([&#x27;sub&#x27;, &#x27;iat&#x27;, &#x27;exp&#x27;, &#x27;role&#x27;]); // adapt to your claims\n\n\n  // Et vérification de la signature du token\n  const verified = jwt.verify(token, process.env.SECRET, {\nalgorithms: [&#x27;HS256&#x27;]\n  });\n\n  expect(verified.sub).to.be.a(&#x27;string&#x27;);\n  expect(verified.role).to.equal(&#x27;admin&#x27;);\n  expect(verified.exp * 1000).to.be.greaterThan(Date.now()); // On s&#x27;assure que le token est toujours valide\n\n  adminToken = verified // Stockage du token administrateur.ice pour plus tard\n  rawAdminToken = token&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a9b6bdfa-1c39-43a0-ac5a-ca2c014c017b&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /users/login/&lt;userID&gt; -&gt; Lambda peut y accéder, Maestro aussi&quot;,&quot;fullTitle&quot;:&quot;USER router PATCH /users/login/&lt;userID&gt; -&gt; Lambda peut y accéder, Maestro aussi&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:425,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userID = userToken.sub\nconst res = await supertest(app)\n.patch(`/users/${userID}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${rawUserToken}`)\n.send({\n  username:\&quot;omicron\&quot;,\n  password:\&quot;azerty\&quot;\n}).expect(200)\n// On s&#x27;assure vite fait que la réponse contient bien les modifications demandées\nexpect(res.body.username).to.equal(\&quot;omicron\&quot;);\nexpect(res.body).to.not.have.property(\&quot;password\&quot;); // La réponse ne doit pas renvoyer le mdp, même hashé. On vérifie au cas où&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e1802409-8942-4d2f-8570-b51613a056a4&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /users/login/&lt;adminID&gt; -&gt; Maestro peut y accéder, Lambda/Omicron ne peut pas&quot;,&quot;fullTitle&quot;:&quot;USER router PATCH /users/login/&lt;adminID&gt; -&gt; Maestro peut y accéder, Lambda/Omicron ne peut pas&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:71,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userID = userToken.sub\nconst res = await supertest(app)\n.patch(`/users/${userID}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${rawAdminToken}`)\n.send({\n  username:\&quot;lambda\&quot;,\n  email:\&quot;some.email@xyz.gay\&quot;\n}).expect(200)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;508d80f0-f991-4511-a8bd-08a96f12a22f&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;PATCH /users/login/&lt;adminID&gt; -&gt; Maestro pourrait y accéder, Lambda ne peut pas et prend une erreur&quot;,&quot;fullTitle&quot;:&quot;USER router PATCH /users/login/&lt;adminID&gt; -&gt; Maestro pourrait y accéder, Lambda ne peut pas et prend une erreur&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1121,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const userID = userToken.sub\n  \n// Création et login d&#x27;un utilisateur juste pour ce test\nconst gammaRes = await supertest(app)\n.post(\&quot;/users/\&quot;)\n.send({\n  email:\&quot;gamma@xyz.org\&quot;,\n  username:\&quot;gamma\&quot;,\n  password:\&quot;test1234\&quot;,\n  role:\&quot;user\&quot;\n}).expect(201).expect(\&quot;Content-type\&quot;,/json/)\nusersIDs.push(gammaRes.body.id)\nconst _res = await supertest(app)\n.post(\&quot;/users/login\&quot;)\n.send({\n  username:\&quot;gamma\&quot;,\n  password:\&quot;test1234\&quot;\n}).expect(200)\nconst { token } = _res.body;\nconst res = await supertest(app)\n.patch(`/users/${userID}`)\n.set(\&quot;Authorization\&quot;,`Bearer ${token}`)\n.send({\n  email:\&quot;evil.email@mean.corp\&quot;,\n  username:\&quot;pwnd\&quot;,\n  password:\&quot;evil-password\&quot;,\n  role:\&quot;evil-admin\&quot;\n}).expect(403).expect(\&quot;Content-type\&quot;,/json/)\nexpect(res.body).to.have.property(&#x27;error&#x27;)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d3b69374-b106-4e6c-bbb0-8ec988e57bf2&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Tente un PATCH sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;fullTitle&quot;:&quot;USER router Tente un PATCH sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const randomID = usersIDs[Math.floor(Math.random() * usersIDs.length)]; // On choisis une ID aléatoire, le test doit échouer de toute manière\nawait supertest(app)\n.patch(`/users/${randomID}`)\n.send({\n  email:\&quot;this.should@fail.now\&quot;\n}).expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;723a4dcb-0087-4e5b-8f04-a96b08b8755d&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;Tente un DELETE sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;fullTitle&quot;:&quot;USER router Tente un DELETE sur l&#x27;ID d&#x27;un.e utilisateur.ice sans authentification&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;const randomID = usersIDs[Math.floor(Math.random() * usersIDs.length)]; // ID aléatoire, encore une fois\nawait supertest(app)\n.delete(`/users/${randomID}`)\n.expect(401)&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42a406d9-602d-4fcf-88d7-ae3b6e45f34c&quot;,&quot;parentUUID&quot;:&quot;7e4352db-97d2-408a-9198-17c40432459c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2847748f-94b2-4326-9ea6-871733a0f9ac&quot;,&quot;c6b09dde-1967-42ab-ae97-637e7a4978be&quot;,&quot;9bca2f0c-ad19-4c84-97a5-f549b94f0a74&quot;,&quot;860303ea-462f-48c8-adf7-b0d92778b20c&quot;,&quot;26c8c040-fe0c-40d4-a7f7-d6119cd2a600&quot;,&quot;a9b6bdfa-1c39-43a0-ac5a-ca2c014c017b&quot;,&quot;e1802409-8942-4d2f-8570-b51613a056a4&quot;,&quot;508d80f0-f991-4511-a8bd-08a96f12a22f&quot;,&quot;d3b69374-b106-4e6c-bbb0-8ec988e57bf2&quot;,&quot;723a4dcb-0087-4e5b-8f04-a96b08b8755d&quot;,&quot;42a406d9-602d-4fcf-88d7-ae3b6e45f34c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:4348,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.4&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.4&quot;},&quot;marge&quot;:{&quot;version&quot;:&quot;6.3.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;FoodExpress&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/home/camille/Documents/PROJECTS-SupInfo/FoodExpress/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>